<head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> </head><script src="static/js/header/jquery.min.js?ver=3.6.1" type="text/javascript"></script>
<script src="static/buf/plugins/wp-favorite-posts/wpfp.js?ver=3.6.1" type="text/javascript"></script>
<script src="static/js/highslide/highslide-with-html.packed.js" type="text/javascript"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
    hs.graphicsDir = "static/buf/plugins/auto-highslide/images/graphics/";
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.addSlideshow({
        interval: 5000,
        repeat: true,
        useControls: true,
        fixedControls: "fit",
        overlayOptions: {
            opacity: 0.75,
            position: "bottom center",
            hideOnMouseOut: true

        }

    });
});
</script>
<script language="JavaScript" src="static/buf/plugins/cartpauj-pm/js/script.js" type="text/javascript"></script>
<script src="static/buf/themes/freebuf/js/layer.js"></script>
<script src="static/buf/plugins/simditor/highlight/highlight.pack.js" type="text/javascript"></script>
<script src="static/buf/themes/freebuf/js/jquery-2.0.3.min.js"></script>
<script src="static/buf/themes/freebuf/js/bootstrap.min.js"></script>
<script src="static/buf/themes/freebuf/js/slider.js?2016022501.1" type="text/javascript"></script>
<script src="static/buf/themes/freebuf/js/jquery.sticky.js" type="text/javascript"></script>
<script src="static/js/focus/bjqs-1.3.min.js" type="text/javascript"></script>
<script src="static/buf/themes/freebuf/js/mosaic.1.0.1.min.js" type="text/javascript"></script>
<script src="static/js/new/setint.js" type="text/javascript"></script>
<script src="static/js/colum/swiper-3.4.2.min.js"></script>
<script type="application/ecmascript">
    $('.icon-wechat').hover(function(){
        $('.wechatImgdiv').show()
    },function(){
        $('.wechatImgdiv').hide()
    })
</script>
<script src="static/js/header/header.js" type="text/javascript"></script>
<script>
		jQuery(window).load(function () {
			jQuery(".main-header").sticky({topSpacing: 0});
		});
	</script>
<script>
                    $('.user-detial .test-info').mouseover(function() {
                        var _title = $(this).find('.text').attr('data-title');
                        if (_title) {
                            var str = '<span class="text-title">' + _title + '</span>';
                            $(this).append(str);
                        }
                    }).mouseout(function() {
                        $('.user-detial .test-info .text-title').remove();
                    });
                </script>
<script type="text/javascript">
				jQuery("#pagination a").live("click", function () {
					var _url = jQuery(this).attr("href");
					jQuery(this).parents("li").addClass("current").blur().parents("#menupage").find("li").not(jQuery(this).parents("li")).removeClass("current");
					jQuery.ajax({
						type: "POST",
						url: _url + "#timeline",
						success: function (data) {
							result = jQuery(data).find("#timeline .news_inner");
							nextHref = jQuery(data).find("#pagination a").attr("href");
							if (nextHref != undefined) {
								jQuery("#pagination a").attr("href", nextHref);
							} else {
								jQuery("#pagination").remove();
							}
							jQuery(function () {
								if (_url.indexOf("page") < 1) {
									jQuery("#timeline").html('');
								}
								jQuery("#timeline").append(result.fadeIn(200));
							});
						}
					});
					return false;
				});
			</script>
<script>
    $('.star_score > a').click(function() {
        $(this).addClass('active');
        $(this).siblings().removeClass('active');
    });
    $('.star_score > a').hover(function() {
        $(this).siblings().removeClass('active');
    });
    $(document).on('click', function() {
        $('.bottom_tools .tips-wrap').hide(500);
    });
    $('.bottom_tools ul li.fb-tips').click(function(event) {
        var evt = event || evt;
        evt.stopPropagation();
        $(this).find('.tips-wrap').toggle(500);
    });
    $('.bottom_tools .tips-wrap').click(function(event) {
        var evt = evt || event;
        evt.stopPropagation();
        $(this).show();
    });
    $('.feedback').on('click',function () {
        var content = $('#feedback-content').val();
        if(!content){
            $('#feedback-content').focus();
            $('.feedback-error').text('反馈内容不能为空！').show();
            return;
        }
        var contact = $('#feedback-contact').val();
        if(!contact){
            $('#feedback-contact').focus();
            $('.feedback-error').text('联系方式不能为空！').show();
            return;
        }
        var score = $('.star_score').children('.active').attr('data-id')
        if(!score){
            $('.feedback-error').text('给FreeBuf打个分吧！').show();
            return;
        }
        var yzm = $('#yzm').val();
        var _url = 'static/verify';
        $.ajax({
            type: "post",
            url: _url,
            data: {'content':content,'contact':contact,'score':score,'feedback_status':1,'yzm':yzm},
            success: function (data) {
                $("#captcha").trigger('click')
                if(data.code ==200){
                    layer.open({
                        title: '系统提示',
                        btnAlign: 'c',
                        content: data.msg,
                        area: '278px',
                    });
                }else {
                    layer.open({
                        title: '系统提示',
                        btnAlign: 'c',
                        content: data.msg,
                        area: '278px',
                    });
                }
            },
        })
    })

    $(document).on('click', '.appeal-wrap-public .appeal-main', function(event) {
        var evt = event || evt;
        evt.stopPropagation();
        $('.appeal-wrap-public').show();
    });
    $(document).on('click', '.appeal-main .close', function(event) {
        var evt = event || evt;
        evt.stopPropagation();
        $('.appeal-wrap').hide();
    });
    $(document).on('click', '.appeal-main .appeal-footer .btn-sure', function(event) {
        var evt = event || evt;
        evt.stopPropagation();
        $('.appeal-wrap-public').hide();
    });

    $('.complain').on('click',function () {
        var _url = 'static/verify';
        var token = $('#complain_token').val();
        $.ajax({
            type: "post",
            url: _url,
            data: {'complain_token':token,'complain_status':1},
            success: function (data) {
            },
        })
    })
</script>
<script src="static/js/new/backtop.js"></script>
<script type="text/javascript">
jQuery(function(){	
	jQuery('.tabPanes ul li').click(function(){
		jQuery(this).addClass('hit').siblings().removeClass('hit');
		jQuery('.panesl>div:eq('+jQuery(this).index()+')').show().siblings().hide();	
	})
	jQuery('.vulbox-nav').click(function(e) { 
        e.stopPropagation(); 
    });  
})
</script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fcc53db168808048541c6735ce30421f5' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
jQuery(function() {
    jQuery(".simditor pre").each(function(i, block){
        hljs.highlightBlock(block);    
    });
    hljs.initHighlightingOnLoad();
});
</script>
<script>
/* <![CDATA[ */
var rcGlobal = {
	serverUrl		:'static',
	infoTemp		:'%REVIEWER% on %POST%',
	loadingText		:'Loading',
	noCommentsText	:'No comments',
	newestText		:'&laquo; 最新',
	newerText		:'&laquo; 新一点',
	olderText		:'旧一点 &raquo;',
	showContent		:'1',
	external		:'1',
	avatarSize		:'32',
	avatarPosition	:'left',
	anonymous		:'Anonymous'
};
/* ]]> */
</script>
<script src="static/js/recentcomments/wp-recentcomments-jquery.js?ver=2.2.3" type="text/javascript"></script>

<link href="static/buf/plugins/wp-favorite-posts/wpfp.css" id="wpfp-css" rel="stylesheet" type="text/css"/>
<link href="static/css/recentcomments/wp-recentcomments.css?ver=2.2.3" id="wp-recentcomments-css" media="screen" rel="stylesheet" type="text/css"/>
<link href="static/buf/plugins/gold/assets/css/widget.css?ver=1.3.2.1" id="mycred-widget-css" media="all" rel="stylesheet" type="text/css"/>
<link href="static/css/highslide/highslide.css" rel="stylesheet" type="text/css"/>
<link href="static/buf/plugins/cartpauj-pm/style/style.css" rel="stylesheet" type="text/css"/>
<link href=" static/buf/plugins/simditor/highlight/styles/default.css" rel="stylesheet" type="text/css"/>
<link href="https://static.freebuf.com/images/favicon.ico" rel="shortcut icon"/>
<link href="static/css/new/header.css" rel="stylesheet"/>
<link href="static/css/new/bootstrap.min.css?ver=2016051701" media="screen" rel="stylesheet"/>
<link href="static/css/new/swiper-3.4.2.min.css" rel="stylesheet" type="text/css"/>
<link href="static/css/new/style.css?ver=2018112123749359438534" rel="stylesheet" type="text/css"/>

<div id="contenttxt">
                            <h2></h2>
<p>话就不多说，让我们开始故事，话说自上古时代，盘古开天辟地，浑沌破晓，阴阳之分从此出来，而我掌控扶摇九千万里的阴神（渗透），不知多少个量劫过去，浑浑噩噩的阳神（入侵分析）也随着时间的推移，慢慢诞生了灵智。</p>
<p>我是一块小石头，在佛道之争过程，终于修炼成人形，我没有荣幸在龙汉初劫中诞生，见识到那时的百家争鸣，我现在只能将前人的风光说给后人听，顺便吹一下自己修炼故事。</p>
<p>我根据虚拟老祖的教学玉筒，虚拟了一片小世界，在这片世界中，我可以虚拟出多个自己，对这些虚拟自己进行攻击练习。</p>
<p>不过要进入要这片世界，就需要找到密钥才能开启</p>
<pre><code>git clone https://github.com/yingshang/yinyang.git<br /></code></pre>
<p>如果找到了密钥，这还不够，因为你还需要docker仙女和python老哥彻彻底底融合才能进行演化天地</p>
<pre><code>apt install docker.io python3-pip
pip3 install docker-compose
pip3 install -r requirements.txt
python3 manage.py runserver</code></pre>
<p>现在就让你们见识一下我演练的天地</p>
<p><img alt="image.png" data-original="images/20190303/1551599991_5c7b89772296e.png" src="images/20190303/1551599991_5c7b89772296e.png" width="690" height="352" />上面只是演示界面，还有<b>很多需要配置</b></p>
<noscript><img alt="image.png" src="images/20190303/1551599991_5c7b89772296e.png" width="690" height="352" />上面只是演示界面，还有<b>很多需要配置</b></p></noscript>
<p>首先，你需要打开docker仙女的内心世界（<b>REST API</b>），测试发现Ubuntu系统大大能够正常打开API，centos就不能，乖，不要做妖怪成杠精哈，我用试了几种方法开启方法都不行，就用Ubuntu，一试就行。</p>
<pre><code>edit /lib/systemd/system/docker.service
ExecStart=/usr/bin/dockerd -H fd:// -H=tcp://0.0.0.0:5555
systemctl daemon-reload
service docker restart<br /></code></pre>
<p><img alt="image.png" data-original="images/20190306/1551876725_5c7fc27544e76.png" src="images/20190306/1551876725_5c7fc27544e76.png" width="537" height="131" />好了，成功打开了API</p>
<noscript><img alt="image.png" src="images/20190306/1551876725_5c7fc27544e76.png" width="537" height="131" />好了，成功打开了API</p></noscript>
<p><img alt="image.png" data-original="images/20190306/1551877055_5c7fc3bfe4793.png" src="images/20190306/1551877055_5c7fc3bfe4793.png" width="690" height="153" /></p>
<noscript><img alt="image.png" src="images/20190306/1551877055_5c7fc3bfe4793.png" width="690" height="153" /></p></noscript>
<p></p>
<hr />
<p>我在目录新建了两个目录，<b>一个是装docker-compose.xml，一个是对应镜像的课程</b>（我当时用dockerfile，但是觉得放到github那边容量太大了，干脆直接push上docker hub，再用docker-compose进行下载），课程的展示我是使用markdown进行解析，因为写教程都是本地写，不是web写，就没打算弄一个编辑器（不过说不定以后会弄。。。）</p>
<p>首先，新的系统没有镜像，需要打开/pull进行下载镜像，我做成了全部下载所有的镜像，也就是docker目录里面的镜像，如果你不想全部下载的，只需要把docker目录的docker-compose.xml删除就行</p>
<p><img alt="image.png" data-original="images/20190307/1551933548_5c80a06c1f925.png" src="images/20190307/1551933548_5c80a06c1f925.png" width="690" height="434" />对于环境的栏目，我是使用docker的tag进行区分，或许可能进行更细的区分</p>
<noscript><img alt="image.png" src="images/20190307/1551933548_5c80a06c1f925.png" width="690" height="434" />对于环境的栏目，我是使用docker的tag进行区分，或许可能进行更细的区分</p></noscript>
<p><img alt="image.png" data-original="images/20190307/1551933741_5c80a12d52f77.png" src="images/20190307/1551933741_5c80a12d52f77.png" width="690" height="672" />启动镜像，可以显示对外端口和状态</p>
<noscript><img alt="image.png" src="images/20190307/1551933741_5c80a12d52f77.png" width="690" height="672" />启动镜像，可以显示对外端口和状态</p></noscript>
<p><img alt="image.png" data-original="images/20190307/1551936680_5c80aca8ca257.png" src="images/20190307/1551936680_5c80aca8ca257.png" width="690" height="333" /></p>
<noscript><img alt="image.png" src="images/20190307/1551936680_5c80aca8ca257.png" width="690" height="333" /></p></noscript>
<p>使用markdown写下课程，然后后台对其解析（虽然有点丑，但是也就这样把=-=没那精力学前端）</p>
<p><img alt="image.png" data-original="images/20190307/1551935053_5c80a64df1527.png" src="images/20190307/1551935053_5c80a64df1527.png" width="690" height="294" /></p>
<noscript><img alt="image.png" src="images/20190307/1551935053_5c80a64df1527.png" width="690" height="294" /></p></noscript>
<p>我当时思考过，当这玩意部署到外网，那么需要对其进行控制防御，于是我写了<b>两道关卡</b></p>
<p><b>第一道就是控制用户启动镜像的次数，假如要是让用户无限制启动，服务器就直接炸了，所以我写了个判断该用户启动的次数，默认是一次，这里可以进行修改</b></p>
<p><img alt="image.png" src="images/20190307/1551935479_5c80a7f7ddc52.png" width="690" height="408" /><img alt="image.png" data-original="images/20190307/1551935498_5c80a80a712ab.png" src="images/20190307/1551935498_5c80a80a712ab.png" width="690" height="362" /><b>第二道关卡就有意思</b></p>
<noscript><img alt="image.png" src="images/20190307/1551935479_5c80a7f7ddc52.png" width="690" height="408" /><img alt="image.png" src="images/20190307/1551935498_5c80a80a712ab.png" width="690" height="362" /><b>第二道关卡就有意思</b></p></noscript>
<p><b>由于docker启动端口的是 docker run -it -p 80:80 ubuntu:14.04,没有进行端口控制，也就是当我部署在外网的时候，我可以访问其他人的靶机，也可以D别人的靶机，所以我就想到使用防火墙进行限制。</b></p>
<p><b>当启动镜像的时候，在防火墙那里添加规则</b></p>
<p><img alt="image.png" src="images/20190307/1551935863_5c80a977e35e6.png" width="690" height="95" /><img alt="image.png" data-original="images/20190307/1551935895_5c80a9977d7b2.png" src="images/20190307/1551935895_5c80a9977d7b2.png" width="690" height="79" />主要是docker port命令不支持限制外网的机器，不然就会报错。</p>
<noscript><img alt="image.png" src="images/20190307/1551935863_5c80a977e35e6.png" width="690" height="95" /><img alt="image.png" src="images/20190307/1551935895_5c80a9977d7b2.png" width="690" height="79" />主要是docker port命令不支持限制外网的机器，不然就会报错。</p></noscript>
<p><img alt="image.png" data-original="images/20190307/1551936083_5c80aa5358e02.png" src="images/20190307/1551936083_5c80aa5358e02.png" width="690" height="153" /></p>
<noscript><img alt="image.png" src="images/20190307/1551936083_5c80aa5358e02.png" width="690" height="153" /></p></noscript>
<pre><code>docker run -p 10.10.10.10:80:80 ubuntu:14.04
docker: Error response from daemon: driver failed programming external connectivity on endpoint loving_lederberg (382503bd4520c928edd392c58144a710c6d5a19b15410799f005ad61a4fcc41e): Error starting userland proxy: listen tcp 10.10.10.10:80: bind: cannot assign requested address.</code></pre>
<p><b>其实还有一道隐藏的关卡，就是控制内存，当内存使用率超过90%，任何用户都启动不了镜像(感觉这是一个作死的关卡，哈哈哈哈~)</b></p>
<p><b><img alt="image.png" data-original="images/20190307/1551936374_5c80ab76d4d1d.png" src="images/20190307/1551936374_5c80ab76d4d1d.png" width="609" height="557" /></b></p>
<noscript><img alt="image.png" src="images/20190307/1551936374_5c80ab76d4d1d.png" width="609" height="557" /></b></p></noscript>
<p><b>当然，这个系统还有很多有意思的功能还没有写，例如自己弄个CTF靶场，然后一堆人进行演练和刷分，不过感觉网上有的是CTF靶场，这想法就被搁置了，不想花时间造轮子，还不如好好提升技术。不过过段时间也可以搞些入侵分析的靶机，进行演练。</b></p>
<p><b><br /></b></p>
<hr />
<p>下面是真正展示这个平台的使用</p>
<p>启动系统之前，需要创建一个账号</p>
<p>python3 manage.py createsuperuser</p>
<p>然后才可以启动，因为我做了用户认证</p>
<p>python3 manage.py runserver 0.0.0.0:8000</p>
<p>然后进入到首页就可以看到系统的状态</p>
<p><img alt="image.png" data-original="images/20190307/1551936866_5c80ad627f130.png" src="images/20190307/1551936866_5c80ad627f130.png" width="690" height="420" />找一个struts2的漏洞来演练一波，启动镜像，在浏览器打开IP:PORT</p>
<noscript><img alt="image.png" src="images/20190307/1551936866_5c80ad627f130.png" width="690" height="420" />找一个struts2的漏洞来演练一波，启动镜像，在浏览器打开IP:PORT</p></noscript>
<p><img alt="image.png" src="images/20190307/1551936948_5c80adb43509b.png" width="690" height="340" /><img alt="image.png" data-original="images/20190307/1551937011_5c80adf3604f6.png" src="images/20190307/1551937011_5c80adf3604f6.png" width="690" height="494" />然后查看课程资料，就可以按照教程去做，不要说我短，不是，是教程短，实在我没有这么多精力，一个一个做得好。</p>
<noscript><img alt="image.png" src="images/20190307/1551936948_5c80adb43509b.png" width="690" height="340" /><img alt="image.png" src="images/20190307/1551937011_5c80adf3604f6.png" width="690" height="494" />然后查看课程资料，就可以按照教程去做，不要说我短，不是，是教程短，实在我没有这么多精力，一个一个做得好。</p></noscript>
<p><img alt="image.png" data-original="images/20190307/1551937041_5c80ae11df417.png" src="images/20190307/1551937041_5c80ae11df417.png" width="690" height="323" /><b>感觉也就介绍的差不多了。然后有人会问你这个跟vulhub和vulapp有什么区别吗？</b></p>
<noscript><img alt="image.png" src="images/20190307/1551937041_5c80ae11df417.png" width="690" height="323" /><b>感觉也就介绍的差不多了。然后有人会问你这个跟vulhub和vulapp有什么区别吗？</b></p></noscript>
<p><b>肯定有啊，起码这样好操作=-=而且我可以去他那边偷取镜像<span style="color:rgb(102,102,102);">(,,・ω・,,)</span></b></p>
<p><b>不过如果有人有兴趣跟我一起弄靶机镜像，可以私信我，咱们一起搞一波。</b></p>
                                
                                <div class="column-support">
                                    <p class="support-mount good_num">1</p>
                                    <a href="javascript:void (0);" data-status="0" data-id="197619" class="good"></a>
                                </div>
                                <script>
                                    $('.good').on('click',function () {
                                        var login = $(this).attr('data-status');
                                        if(login){
                                            var token = $('#token').val();
                                            var id = $(this).attr('data-id');
                                            var good = $('.good_num').text();
                                            var _this = $(this);
                                            var _url = document.location.href;
                                            $.ajax({
                                                type: "post",
                                                url: _url,
                                                data: {'token':token,'id':id, 'good':1},
                                                success: function (data) {
                                                    $('#token').val(data.token);
                                                    if(data.code ==400){
                                                        layer.open({
                                                            title: '系统提示',
                                                            btnAlign: 'c',
                                                            content: data.msg,
                                                            area: '278px',
                                                        });
                                                    }else {
                                                        if(good){
                                                            good++;
                                                        }else {
                                                            good=1;
                                                        }
                                                        $('.good_num').text(good);
                                                        _this.disabled();
                                                    }
                                                },
                                            })
                                        }else {
                                            layer.open({
                                                title: '系统提示',
                                                btnAlign: 'c',
                                                content: '请先登录',
                                                btn: ['登录'],
                                                area: '278px',
                                                yes: function () {
                                                    login();
                                                },
                                            });
                                        }
                                        return false;
                                    })
                                    function login(){
                                        window.location.href = 'https//www.freebuf.com/oauth';
                                    }
                                </script>
                                                    </div>
                        <div class="wechatcodeDiv">